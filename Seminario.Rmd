---
title: "Seminario:Calidad del Aire y Defunciones por Enfermedades Respiratorias"
subtitle: " Repositorio: [GitHub](https://github.com/MinayaMR/Seminario)"
author:
- name: "Aya Toussi"
- name: " Minaya Moreno Romero"
- name: "Vanessa Pérez Paredes"

date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```{r, echo=FALSE}
htmltools::img(src = knitr::image_uri("Escudo Color TC.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; left:0; padding:10px; width:100px; height:100px;')
```


## **INTRODUCCIÓN:**
En este seminario se ha recopilado información y llevado a cabo un análisis sobre la calidad del aire en las diferentes comunidades autónomas de España Peninsular y la tasa de muertes por enfermedades respiratorias a lo largo de varios años en dichas regiones.

Finalmente se ha explorado la relación existente entre la calidad del aire y la mencionada tasa de mortalidad.

## **OBJETIVO GENERAL:**
Los objetivos generales de este seminario han sido:

- El estudio de la evolución de las defunciones por comunidades autónomas a lo largo de los años.
- El estudio de la calidad del aire según la concentración de gases obtenida en cada comunidad autónoma y como cambia a lo largo de los años.
- **Objetivo principal:** Analizar y examinar ambos sets de datos y determinar si existe una relación directa entre la calidad del aire que respire la población de cada comunidad autónoma y su tasa de defunción por enfermedades respiratorias.

## **METODOLOGíA :**
### Metodologías del Primer Objetivo General:
- Descargar los archivos en formato .csv que contienen las informaciones de defunciones anuales por Enfermedades Respiratorias para cada Comunidad Autónoma de España Peninsular desde 2010 a 2019. Estas tablas se han obtenido en totalidad a través de la página oficial del INEbase que es el sistema utilizado por el INE (Instituto Nacional de Estadística) para el almacenamiento de la información estadística en Internet. [Enlace directo al recurso utilizado para descargar los archivos](https://www.ine.es/jaxiT3/Tabla.htm?t=10803&L=0)
- Filtrar y cargar los datos para cada Comunidad Autónoma,organizarlos por años y por Comunidades en dataframes para cada año del 2010 al 2019.
- Representar la evolución de la tasa de Mortalidad obtenida en las diferentes Comunidades Autónomas para cada año en unas gráficas distintas del 2010 al 2019.

### Metodologías del Segundo Objetivo General:
- Se ha sacado la tabla principal en formato .xlsx de los datos de Calidad de Aire en España de la página oficial de la OMS [Enlace directo al recurso](https://www.who.int/data/gho/data/themes/air-pollution/who-air-quality-database/2022). Viene representada por Provincias y incluye las medidas de 3 contaminantes .
- Filtar la tabla principal para los datos que solo vienen por España,y luego agrupar los datos dados por Provincias para pasarlos a unas tablas representadas por Comunidades Autónomas.
- Obtener las tablas filtradas y agrupadas por cada Comunidad Autónoma.
- Representar los datos de cada Comunidad Autónoma a lo largo de los años (Del 2010 al 2019).
- Se han buscado otras tablas en distintos formatos(.csv, .xlsx/xls, .ods ) complementarias (por falta y escasez de datos por años y por contaminantes) para incluirlas en el análisis.
Para ello,se han utilizado varias fuentes de datos (Datos Abiertos de España,MITECO,y algunas fuentes y herramientas autonómicas y gubernamentales) [ Datos Abiertos de España](https://datos.gob.es/es/),[MITECO](https://www.miteco.gob.es/es/calidad-y-evaluacion-ambiental/temas/atmosfera-y-calidad-del-aire/calidad-del-aire/evaluacion-datos/redes.html)
- Se procede con lo mismo con las tablas complementarias:limpieza,,cambio de medidas,cambio de sintáxis,selección y filtrado de los datos.

### Metodología del Objetivo General:
- Obtener un tibble (dataframe) filtrado que contenga los datos de la tasa de Mortalidad a nivel de cada Comunidad Autónoma para cada año.
- Obtener un tibble (dataframe) filtrado que contenga los datos de Concentración de los tres Contaminantes para cada año,y para cada contaminante (separados y juntos).
- Combinar los tibbles obtenidos (dataframes) de la Tasa de Mortalidad con su correspondiente para la Concentración de los Contaminantes,y graficar la relación entre ambos. 



###  CARGA DE PAQUETES:

```{r,message=FALSE,warning=FALSE}
#PAQUETES A INSTALAR:
library(ggplot2)
library(rjson)
library(readxl)
library(tidyverse)
library(jsonlite)
library(readr)
library(dplyr)
library(readODS)
library(tidyr)
library(knitr)
```


```{r,include=FALSE}
source("seminario.R", local = knitr::knit_global())
```


###DATOS DE DEFUNCIONES POR COMUNIDADES AUTONOMAS DESDE 2007 A 2021
##DATOS DE DEFUNCIONES PARA CADA CCAA EN EL PERIODO DE 2007 HASTA 2021

```{r, message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("seminario.R")

vlc_rec<-
  vlc_datos %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))


andalucia_rec<-
  andalucia_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))


aragon_rec<-
  aragon_data %>% 
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

asturias_rec<-
  asturias_data %>% 
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

cat_rec<-
  cat_data %>% 
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))


clm_rec<-
  clm_data %>% 
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))


cyl_rec<-
  cyl_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

euskadi_rec<-
  euskadi_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))


extremadura_rec<-
  extremadura_data %>% 
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

gal_rec<-
  gal_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

mad_rec<-
  mad_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

mrc_rec<-
  mrc_data %>%
  mutate(IDM=as.numeric(gsub("\\.","",IDM)))

total_defunciones_CCAA<-
  rbind(andalucia_rec,aragon_rec,asturias_rec,baleares_data,canarias_rec,cantabria_data,cat_rec,clm_rec,cyl_rec,euskadi_rec,extremadura_rec,gal_rec,mad_rec,mrc_rec,nvr_data,rioja_data,vlc_rec) %>% 
  arrange(.data=.,desc(IDM))

knitr::kable(total_defunciones_CCAA)

```


##GRÁFICO DE BARRAS:EVOLUCION DE IDM POR CCAA POR EL PERIODO DE TIEMPO DADO[2007,2021]
```{r, message=FALSE,warning=FALSE}
IDM_CCAA_graph<-
  ggplot(data=total_defunciones_CCAA,aes(x=factor(Year),y=IDM,fill=CCAA,width=1.5))+
  geom_bar(stat = "identity",color="black", position = position_dodge(width = 0.7)) +
  labs(title = "Gráfico de Barras:Evolución de IDM por CCAA por el periodo de tiempo 2007 a 2021(ambos inclusivos)",
       x = "Años",
       y = "Índice de Mortalidad",
       fill = "CCAA") +
  theme_minimal()

print(IDM_CCAA_graph)

```

###DATOS DE CALIDAD DEL AIRE ccAA PARA LOS AÑOS 2010 A 2019
##TABLAS NO2 PARA TODAS LAS CCAA 

```{r, message=FALSE,warning=FALSE}
total_años_no2<-
  bind_rows(ccaa_2010_no2, ccaa_2013_no2, ccaa_2014_no2, ccaa_2015_no2, ccaa_2016_no2, ccaa_2017_no2, ccaa_2018_no2, ccaa_2019_no2)
knitr::kable(total_años_no2)


```


##TABLA PM10 PARA TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
total_años_pm10<-
  bind_rows(ccaa_2010_pm10, ccaa_2011_total_pm10, ccaa_2012_total_pm10, ccaa_2013_pm10, ccaa_2014_pm10, ccaa_2015_pm10, ccaa_2016_pm10, ccaa_2017_pm10, ccaa_2018_pm10, ccaa_2019_pm10)

total_años_pm10 <- total_años_pm10 %>%
  mutate(`PM10 (μg/m3)` = replace(`PM10 (μg/m3)`, is.na(`PM10 (μg/m3)`), 0))


knitr::kable(total_años_pm10)


```



##TABLA PM2.5 PARA TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
total_años_pm2.5<-
  bind_rows(ccaa_2010_pm2.5,ccaa_2011_total_pm2.5, ccaa_2012_total_pm2.5, ccaa_2013_pm2.5, ccaa_2014_pm2.5, ccaa_2015_pm2.5, ccaa_2016_pm2.5, ccaa_2017_pm2.5, ccaa_2018_pm2.5, ccaa_2019_pm2.5)

total_años_pm2.5 <- total_años_pm2.5 %>%
  mutate(`PM2.5 (μg/m3)` = replace(`PM2.5 (μg/m3)`, is.na(`PM2.5 (μg/m3)`), 0)) 



knitr::kable(total_años_pm2.5)


```


###GRAFICOS CALIDAD DEL AIRE
##GRAFICA NO2 PARA EL PERIODO 2010-2019 Y TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
total_años_no2$`Measurement Year`<-as.factor(total_años_no2$`Measurement Year`)
grafica_NO2<-
  ggplot(data=total_años_no2, aes(x = `Measurement Year`, y =`NO2 (μg/m3)`, fill = CCAA)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Niveles de NO2 por CCAA (2010-2019)",
       x = "Año",
       y = "Niveles de NO2 (μg/m3)",
       fill = "CCAA") +
  theme_classic()
print(grafica_NO2)


```
##GRAFICA PARA PM10 PARA EL PERIODO 2011-2019 TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
total_años_pm10$`Measurement Year`<-as.factor(total_años_pm10$`Measurement Year`)
grafica_pm10<-
  ggplot(total_años_pm10, aes(x = `Measurement Year`, y = `PM10 (μg/m3)`, fill = CCAA)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Niveles de pm10 por CCAA (2010-2019)",
       x = "Año",
       y = "Niveles de pm10 (μg/m3)",
       fill = "CCAA") +
  theme_classic()
print(grafica_pm10)


```

##GRAFICA PARA PM2.5 PARA EL PERIODO 2011-2019 TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
total_años_pm2.5$`Measurement Year`<-as.factor(total_años_pm2.5$`Measurement Year`)
options(scipen = 999)
grafica_pm2.5<-
  ggplot(total_años_pm2.5, aes(x = `Measurement Year`, y = `PM2.5 (μg/m3)`, fill = CCAA)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Niveles de pm2.5 por CCAA (2010-2019)",
       x = "Año",
       y = "Niveles de pm2.5 (μg/m3)",
       fill = "CCAA") +
  theme_classic()
print(grafica_pm2.5)


```

###TABLA NO2 JUNTO CON DEFUNCIONES AÑOS 2010-2019
```{r, message=FALSE,warning=FALSE}
no2_mortalidad_completo<-
  bind_rows(tabla_no2_2010, tabla_no2_2013, tabla_no2_2012, tabla_no2_2014, tabla_no2_2015, tabla_no2_2016, tabla_no2_2017, tabla_no2_2018, tabla_no2_2019 ) %>% 
  select(CCAA:`NO2 (μg/m3)`)
no2_mortalidad_completo$Year<-as.factor(no2_mortalidad_completo$Year)

no2_mortalidad_completo_final <- no2_mortalidad_completo %>%
  mutate(`NO2 (μg/m3)` = replace(`NO2 (μg/m3)`, is.na(`NO2 (μg/m3)`), 0)) 

knitr::kable(no2_mortalidad_completo)

```

##TABLA PM10 JUNTO CON DEFUNCIONES AÑOS 2010-2019
```{r, message=FALSE,warning=FALSE}
pm10_mortalidad_completo<-
  bind_rows(tabla_pm10_2010, tabla_pm10_2012, tabla_pm10_2013, tabla_pm10_2013,  tabla_pm10_2014,  tabla_pm10_2015,  tabla_pm10_2016, tabla_pm10_2017,tabla_pm10_2018,tabla_pm10_2019) %>% 
  select(CCAA:`PM10 (μg/m3)`)

pm10_mortalidad_completo$Year<-as.factor(pm10_mortalidad_completo$Year)

pm10_mortalidad_completo_final <- pm10_mortalidad_completo %>%
  mutate(`PM10 (μg/m3)` = replace(`PM10 (μg/m3)`, is.na(`PM10 (μg/m3)`), 0)) 

knitr::kable(pm10_mortalidad_completo)

```

##TABLA PM2.5 JUNTO DEFUNCIONES AÑOS 2010-2019
```{r, message=FALSE,warning=FALSE}
pm2.5_mortalidad_completo<-
  bind_rows(tabla_pm25_2010, tabla_pm25_2012, tabla_pm25_2013, tabla_pm25_2014, tabla_pm25_2015, tabla_pm25_2016, tabla_pm25_2017, tabla_pm25_2018, tabla_pm25_2019 ) %>% 
  select(CCAA:`PM2.5 (μg/m3)`)

pm2.5_mortalidad_completo$Year<-as.factor(pm2.5_mortalidad_completo$Year)

pm2.5_mortalidad_completo_final <- pm2.5_mortalidad_completo %>%
  mutate(`PM2.5 (μg/m3)` = replace(`PM2.5 (μg/m3)`, is.na(`PM2.5 (μg/m3)`), 0)) 

knitr::kable(pm2.5_mortalidad_completo)

```


###GRAFICOS UNION CALIDAD AIRRE Y DEFUNCIONES
##GRAFICO NO2 Y DEFUNCIONES TODAS CCAA
```{r, message=FALSE,warning=FALSE}
grafico_combinado_no2_final <- ggplot(data=no2_mortalidad_completo_final, aes(x = CCAA, y = IDM, fill =`NO2 (μg/m3)`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
print(grafico_combinado_no2_final)

```



##GRAFICO PM10 JUNTO DEFUNCIONES PARA TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
grafico_combinado_pm10_final <- ggplot(data=pm10_mortalidad_completo_final, aes(x = CCAA, y = IDM, fill =`PM10 (μg/m3)`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
print(grafico_combinado_pm10_final)

```


##GRAFICO PM2.5 JUNTO DEFUNCIONES PARA TODAS LAS CCAA
```{r, message=FALSE,warning=FALSE}
grafico_combinado_pm2.5 <- ggplot(data=pm2.5_mortalidad_completo_final, aes(x = CCAA, y = IDM, fill =`PM2.5 (μg/m3)`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
print(grafico_combinado_pm2.5)

```


